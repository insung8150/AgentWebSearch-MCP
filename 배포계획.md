# LocalWebSearch-CDP 배포 계획

> 작성일: 2026-02-18
> 프로젝트명 변경: Agent-search-v3-CDmcp-v1 → **LocalWebSearch-CDP**

---

## 프로젝트 핵심 가치

### "API 키 없는 로컬 WebSearch"

로컬 LLM 사용자들의 고충:
- Claude API의 WebSearch 같은 기능을 로컬에서 쓰고 싶음
- 하지만 검색 API (Tavily, Brave API, Google API)는 **API 키 필요**
- 일반 사용자가 API 키 발급받는 것은 **귀찮고 어려움**
- 결국 검색 기능 포기...

**이 프로젝트의 해결책:**
- Chrome만 있으면 됨 (API 키 불필요)
- CDP (Chrome DevTools Protocol)로 실제 브라우저 제어
- WebSearch와 동일한 기능, 시간만 좀 더 걸릴 뿐

### 기존 방법 vs 이 프로젝트

| 방법 | API 키 | 비용 | 난이도 |
|------|--------|------|--------|
| Tavily | 필요 | 유료 | 어려움 |
| Brave Search API | 필요 | 무료(제한) | 귀찮음 |
| Google Custom Search | 필요 | 유료 | 매우 귀찮음 |
| SearXNG | 설치 필요 | 무료 | 복잡함 |
| **LocalWebSearch-CDP** | **불필요** ⭐ | **무료** | **Chrome만 설치** |

### 성능 비교

| 항목 | WebSearch (Claude API) | LocalWebSearch-CDP |
|------|------------------------|---------------------|
| 속도 | ~37초 | ~80초 (2배 느림) |
| 비용 | API 비용 | **무료** |
| API 키 | 필요 | **불필요** |
| 오프라인 | 불가 | **가능** (인터넷만 있으면) |
| 한국 포털 | 제한적 | **네이버 지원** |

---

## 프로젝트 이름 변경 이유

### 원래 이름: Agent-search-v3-CDmcp-v1
- **CDmcp** = Chrome DevTools MCP 사용 의도

### 실제 구현: CDP 직접 통신
- MCP 사용 시 문제점:
  - 탭 목록 제대로 못 봄
  - "현재 선택된 페이지"에서만 작업
  - 탭 인덱스 관리 안 됨
  - 마지막 탭만 재사용
  - **병렬 검색 불가**
- 해결: CDP WebSocket 직접 통신 + 크롬 3개 인스턴스

### 새 이름: LocalWebSearch-CDP
- **Local** = 로컬 LLM 대상
- **WebSearch** = Claude WebSearch 대안
- **CDP** = 실제 구현 방식 (Chrome DevTools Protocol)

---

## 기능적 평가

### 현재 구현된 기능

| 기능 | 상태 | 가치 |
|------|------|------|
| CDP 병렬 검색 (크롬 3개) | ✅ | 빠르고 안정적 |
| 네이버/구글/Brave 통합 | ✅ | 한국 + 글로벌 |
| 세션 유지 (봇 탐지 회피) | ✅ | 실용적 |
| 캡챠 자동 감지 | ✅ | 편의성 |
| 탐지 회피 플래그 | ✅ | 안정성 |
| 로컬 LLM 연동 | ✅ | 핵심 기능 |
| E2E 에이전틱 검색 | ✅ | 완성도 |

### 기존 버전 대비 개선

| 항목 | v3 (HTTP 크롤링) | LocalWebSearch-CDP |
|------|------------------|---------------------|
| 검색 속도 | ~17초 | **~5초** (3.4배 빠름) |
| E2E 시간 | ~85-90초 | ~80초 |
| 차단 회피 | fallback 연쇄 | **세션 유지 + 탐지 회피** |
| 안정성 | 불안정 (CAPTCHA) | **안정** |
| 병렬 검색 | 포털 순차 | **진짜 병렬 (크롬 3개)** |

### 솔직한 평가

**장점 (차별점):**
- API 키 불필요 - 진입 장벽 없음
- 한국 포털 (네이버) 지원 - 해외 프로젝트에 없음
- CDP 직접 제어 - MCP 의존성 없이 단순
- 로컬 LLM 연동 - API 비용 없음
- 진짜 병렬 검색 - 크롬 3개

**부족한 점:**
- UI 없음 (CLI만)
- 스트리밍 응답 없음
- 멀티턴 대화 없음

**결론:** 포트폴리오/실용 프로젝트로 **충분히 공개 가치 있음**

---

## GitHub 공개 준비 사항

### 필수 (욕 안 먹으려면)

| 항목 | 상태 | 비고 |
|------|------|------|
| README.md | ❌ 작성 필요 | 핵심 가치 강조 |
| requirements.txt | ❌ 작성 필요 | 의존성 |
| .gitignore | ❌ 작성 필요 | venv, __pycache__ 등 |
| LICENSE | ❌ 선택 필요 | MIT 권장 |
| 불필요 파일 정리 | ❌ | mcp_client.py 등 |

### 권장 (좋은 평가)

| 항목 | 상태 |
|------|------|
| 영어 README | ❌ |
| 설치 가이드 (step-by-step) | ❌ |
| 스크린샷/GIF | ❌ |
| 아키텍처 다이어그램 | ❌ |

### README 핵심 메시지

```markdown
# LocalWebSearch-CDP

🔍 **API 키 없는 로컬 WebSearch**

로컬 LLM (Ollama, LM Studio)에서 WebSearch 기능이 필요하신가요?
API 키 발급 없이, Chrome만 있으면 됩니다.

- ✅ API 키 불필요
- ✅ 무료
- ✅ 네이버/구글/Brave 병렬 검색
- ✅ 로컬 LLM 연동
```

---

## 프로젝트 역할 분담

### 오케스트레이션 (기획/방향): inchul

사용자가 한 핵심 결정들:
1. "크롬 3개 띄우면?" → 진짜 병렬 아키텍처 결정
2. "탭 재사용 대신 크롬 분리" → 핵심 아키텍처 전환
3. "네이버 통합검색으로" → 검색 품질 개선
4. "타임아웃 2-3초 아니니?" → 속도 최적화
5. "캡챠 감지 가능?" → 기능 추가 아이디어
6. "API 키 없이 로컬 WebSearch" → **핵심 가치 정의**

### 코드 작성: Claude

- CDP 직접 통신 구현
- 크롬 3개 인스턴스 관리
- 캡챠 감지 로직
- 탐지 회피 플래그

### 커밋 시 Co-Authored-By

```
Co-Authored-By: inchul <insung8150@...>
Co-Authored-By: Claude <noreply@anthropic.com>
```

(사용자 동의: "아 머 그렇게 하지머 난 열린사람이니까 ㅎㅎ")

---

## 파일 구조 (정리 후)

```
LocalWebSearch-CDP/
├── README.md                # 핵심 가치 강조
├── requirements.txt         # 의존성
├── .gitignore              # venv, __pycache__ 등
├── LICENSE                 # MIT
├── search_agent.py         # 메인 에이전트
├── cdp_search.py           # CDP 직접 검색 (병렬)
├── chrome_launcher.py      # 크롬 3개 관리
├── start_sglang.sh         # SGLang 서버 시작
├── outputs/                # 로그
└── docs/
    ├── 에이젼틱검색_원시계획_v3-CDmcp-v1.md  # 개발 기록
    └── 배포계획.md          # 이 파일
```

### 삭제 예정 파일
- `mcp_client.py` - 사용 안 함 (CDP 직접 통신으로 대체)
- `smartCrawl_server/` - 있으면 삭제 (CDP로 대체)
- `smartcrawl-mcp/` - 있으면 삭제 (CDP로 대체)

---

## 포털 확장 구조

### Claude Code 자동 추가 지원

사용자가 "Bing 포털 추가해줘"라고 하면, Claude Code가 주석을 읽고 자동으로 추가할 수 있도록 가이드 주석 작성 완료.

### 주석 위치
- `cdp_search.py`: PORTAL_CONFIG 위에 포털 추가 가이드
- `chrome_launcher.py`: CHROME_INSTANCES 위에 크롬 인스턴스 추가 가이드

### 지원 예시 포털
| 포털 | 국가 | 포트 (예시) |
|------|------|-------------|
| Bing | 글로벌 | 9225 |
| DuckDuckGo | 글로벌 | 9226 |
| Baidu | 중국 | 9227 |
| Yandex | 러시아 | 9228 |
| Yahoo Japan | 일본 | 9229 |

### 사용자 시나리오
```
사용자: "Bing 포털 추가해줘"

Claude Code:
1. cdp_search.py 주석 읽음
2. PORTAL_CONFIG에 bing 항목 추가
3. chrome_launcher.py 주석 읽음
4. CHROME_INSTANCES에 bing 항목 추가
5. 완료!
```

### 오픈소스 기여
- 다른 나라 사용자가 자국 포털 추가 후 PR 가능
- 커뮤니티에서 extract_script 공유/개선

---

## 향후 계획: MCP 버전

### 왜 MCP인가?

현재는 Python 스크립트 직접 실행:
```bash
python search_agent.py "검색어"
```

MCP로 만들면 Claude Code / 로컬 LLM에서 도구로 호출:
```bash
claude mcp add localwebsearch -- python /path/to/mcp_server.py
```

### MCP 구조 (예정)

```
[호스트 LLM] (Claude Code, LM Studio, Ollama 등)
     ↓
[LocalWebSearch MCP] ← 검색 도구 제공
     ↓
[CDP] → Chrome 3개 → 네이버/구글/Brave
```

### MCP 도구 설계 (예정)

| 도구 | 설명 |
|------|------|
| `search` | 키워드로 검색 (네이버/구글/Brave 병렬) |
| `fetch_url` | URL 본문 가져오기 |
| `add_portal` | 새 포털 추가 (동적) |
| `list_portals` | 사용 가능한 포털 목록 |
| `chrome_status` | 크롬 인스턴스 상태 확인 |

### MCP 장점

| 항목 | 스크립트 | MCP |
|------|----------|-----|
| Claude Code 연동 | ❌ | ✅ |
| 로컬 LLM 연동 | 직접 호출 | **도구로 호출** |
| 범용성 | 낮음 | **높음** |
| 설치 | 복잡 | `claude mcp add` |

### 구현 순서

```
1. 기능 완성 ← 현재 단계
2. 테스트/안정화
3. GitHub 공개 (스크립트 버전)
4. MCP 버전 제작 ← 향후
5. npm/PyPI 배포 (선택)
```

### MCP 구현 시 참고

- MCP SDK: `@anthropic-ai/sdk` (TypeScript) 또는 `mcp` (Python)
- 기존 코드 재사용: `cdp_search.py`, `chrome_launcher.py`
- JSON-RPC 2.0 over stdio

---

## 다음 단계 (현재)

1. [ ] 프로젝트 폴더명 변경: `Agent-search-v3-CDmcp-v1` → `LocalWebSearch-CDP`
2. [ ] 불필요 파일 정리
3. [ ] README.md 작성 (한글 + 영어)
4. [ ] requirements.txt 생성
5. [ ] .gitignore 생성
6. [ ] LICENSE 추가 (MIT)
7. [ ] 최종 테스트
8. [ ] GitHub 저장소 생성 및 푸시

---

## 대화 기록 (사적인 내용 포함)

### 기능적 평가 논의

**사용자**: "이정도면 깃허브에 공개해도 욕안먹을 정도 될까?"

**Claude**: 필수 파일(README, requirements.txt 등) 부족 지적

**사용자**: "이니 기능적으로 말이야"

**Claude**: 기능적으로 평가:
- 포트폴리오/학습용: ✅ 충분함
- 대중적 인기: △ Perplexica 수준은 아님
- 틈새 시장 (한국어 + 로컬 LLM): ✅ 가치 있음

### 핵심 가치 발견

**사용자**: "로컬llm을 사용하면 너의 websearch같은기능을 사실 구현하기가 힘들쟎야 api key가 필요하고 보통사람이 key넣는거 아주 귀찮야하지. 근데 이거는 너의 websearch같이 로컬에서 구현되는거쟎야"

→ **핵심 가치 정의**: "API 키 없는 로컬 WebSearch"

### 역할 인정

**사용자**: "아 진짜~~~ 머 너의 작품이지만 내가 그래도 오케스트레이션은 했지 그지~"

**Claude**: "맞습니다! 저는 손이고, 방향은 사용자가 잡았습니다."

### Co-Authored-By 동의

**Claude**: "Co-Authored-By 넣을 때 사용자 이름 먼저 넣어야겠네요"

**사용자**: "아 머 그렇게 하지머 난 열린사람이니까 ㅎㅎ"

### 프로젝트 이름 결정

**사용자**: "근데 제목처럼 chrome devtools mcp를 사용해서 핸드링하는것 아니니?"
**사용자**: "mcp는 탭초기화도 안되었다고 했지않아?"

**Claude**: MCP 문제점 설명, 이름 변경 제안

**사용자**: "LocalWebSearch-CDP가 좋겠다"

---

## 마무리

이 프로젝트는 **API 키 없이 로컬 LLM에서 WebSearch 기능을 사용하고 싶은 사람들**을 위한 것.

- 기획/방향: inchul (오케스트레이션)
- 구현: Claude (코딩)
- 핵심 가치: "API 키 불필요 + 무료 + 로컬"

GitHub 공개 시 이 가치를 명확히 전달하면 충분히 스타 받을 수 있는 프로젝트!
